name: Update IP and domain name lists

on:
  workflow_dispatch:
  push:
    paths:
      - 'script/cust_gfwdomain.conf'

  schedule:
    - cron: 0 4 */3 * *

jobs:
  Smartdns-GFWList:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          token: ${{ secrets.REPO_TOKEN }}
      - name: Smartdns conf List
        run: |
          bash script/update.sh
      
      - name: 上传配置文件到Releases
        uses: softprops/action-gh-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.REPO_TOKEN }}
        with:
          tag_name: config-update-$(date +'%Y%m%d-%H%M%S')
          files: |
            blacklist-ip.conf
            direct-domain-list.conf
            proxy-domain-list.conf
            ros_dns_static.rsc
          draft: false
          prerelease: false
          generate_release_notes: true
